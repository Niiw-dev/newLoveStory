{% extends "header_footer.html" %}
{% block titulo %}Acerca de nosotros{% endblock %}

{% block contenido %}
{% load static %}
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reserva</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.es.min.js"></script>

<style>
.flatpickr-calendar.inline {
  width: 100% !important;
  max-width: 100% !important;
  box-sizing: border-box;
}

.flatpickr-innerContainer{
  width: 100% !important;
}

.flatpickr-rContainer{
  width: 100% !important;
}

.dayContainer {
  width: 100% !important;
  display: grid !important;
  grid-template-columns: repeat(7, 1fr); /* 7 d√≠as por fila */
  max-width: 100% !important;
}

.flatpickr-days{
  width: 100% !important;
  text-align: center;
  margin: 0 !important;
}

.flatpickr-day{
  width: 100% !important;
  max-width: unset !important;
  flex: unset !important;
  text-align: center;
  margin: 0 !important;
}
#datepicker{
    text-align: center;
}

</style>
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="mb-4">Agendar tu cita</h2>

  <form id="reservaForm" method="POST" action="{% url 'agendar_reserva' %}">
    {% csrf_token %}

    <!-- Paso 1 -->
    <div id="step1" class="step">
      <h4>Selecciona fecha, hora, paquete y servicio</h4>
      <div class="d-flex py-3 px-1">
        <div class="col-md-6">
          <input id="datepicker" class="w-100 form-control">
          <input type="hidden" id="fecha-seleccionada" name="fecha">
        </div>
         <!-- Hora, servicio, paquete -->
        <div class="col-md-6">
          <div class="form-group">
            <label>Hora</label>
            {{ form.hora }}
          </div>
          <div class="form-group">
            <label>Paquete</label>
            {{ form.paquete }}
          </div>
          <div class="form-group">
            <label>Servicio</label>
            {{ form.servicio }}
          </div>
        </div>
      </div>

      <button type="button" id="btn-siguiente" class="btn btn-primary float-right mt-3" onclick="nextStep(2)">
        Siguiente ‚Üí
      </button>
    </div>

    <!-- ‚úÖ Frame 2: Datos personales -->
    <!-- Paso 2 -->
    <div id="step2" class="step d-none">
      <h4>Datos del cliente</h4>
      {% if user.is_authenticated and user.cliente %}
        <p>Reservando como: <strong>{{ user.cliente.nombre }} {{ user.cliente.apellido }}</strong></p>
        <input type="hidden" name="cliente_id" value="{{ user.cliente.id }}">
      {% else %}
        <input type="text" name="nombre" placeholder="Nombre" class="form-control mb-2" required>
        <input type="text" name="apellido" placeholder="Apellido" class="form-control mb-2" required>
        <input type="email" name="email" placeholder="Correo electr√≥nico" class="form-control mb-2" required>
        <input type="text" name="telefono" placeholder="Tel√©fono" class="form-control mb-2" required>
        <input type="text" name="direccion" placeholder="Direcci√≥n" class="form-control mb-2" required>
      {% endif %}

      <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="prevStep(1)">‚Üê Atr√°s</button>
        <button type="submit" class="btn btn-success">Confirmar Reserva</button>
      </div>
    </div>
  </form>

</div>

<!-- ‚úÖ jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- ‚úÖ Bootstrap JS (si usas bootstrap-datepicker necesitas tambi√©n bootstrap js y css) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- ‚úÖ Bootstrap Datepicker -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
<!-- Idioma espa√±ol -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.es.min.js"></script>


<script>
function setRequired(step) {
  // Quitar required de todo
  document.querySelectorAll('.step input, .step select, .step textarea').forEach(el => {
    if (el.hasAttribute("required")) {
      el.setAttribute("data-required", "true"); // recordar que era required
    }
    el.removeAttribute("required");
  });

  // Poner required solo en el paso visible
  document.querySelectorAll('#step' + step + ' input, #step' + step + ' select, #step' + step + ' textarea').forEach(el => {
    if (el.dataset.required === "true") {
      el.setAttribute("required", "required");
    }
  });
}

function nextStep(step) {
  document.querySelectorAll('.step').forEach(s => s.classList.add('d-none'));
  document.getElementById('step' + step).classList.remove('d-none');
  setRequired(step);
}

function prevStep(step) {
  nextStep(step);
}

// Inicializar en el paso 1
document.addEventListener("DOMContentLoaded", () => setRequired(1));
document.addEventListener("DOMContentLoaded", function() {
  let diasOcupados = {{ dias_ocupados|safe }};

  // üöÄ Inicializar calendario
  flatpickr("#datepicker", {
    dateFormat: "Y-m-d",        // Formato yyyy-mm-dd
    minDate: "today",           // No permitir fechas pasadas
    locale: "es",               // Calendario en espa√±ol
    disable: diasOcupados,      // Bloquear d√≠as ocupados
    inline: true,
    onChange: function(selectedDates, dateStr, instance) {
      document.getElementById("fecha-seleccionada").value = dateStr;
    }
  });
});
</script>




</body>
</html>
{% endblock %}
